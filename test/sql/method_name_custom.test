# name: test/sql/method_name_custom.test
# description: Test custom method_name parameter across multiple models
# group: [core]

require anofox_forecast

statement ok
LOAD anofox_forecast;

# Create test data
statement ok
CREATE TABLE test_data AS
SELECT 
    ('2024-01-01'::TIMESTAMP + INTERVAL (i) DAY) AS date_col,
    (100.0 + i * 2.5)::DOUBLE AS value
FROM generate_series(1, 30) t(i);

# Test 1: Custom method_name with Naive model
query I
SELECT method_name = 'MyCustomNaive'
FROM ts_forecast(test_data, date_col, value, 'Naive', 5, {'method_name': 'MyCustomNaive'})
LIMIT 1;
----
true

# Test 2: Custom method_name with SES model
query I
SELECT method_name = 'CustomSmoother'
FROM ts_forecast(test_data, date_col, value, 'SES', 5, {'method_name': 'CustomSmoother', 'alpha': 0.3})
LIMIT 1;
----
true

# Test 3: Custom method_name with Holt model
query I
SELECT method_name = 'HoltV2'
FROM ts_forecast(test_data, date_col, value, 'Holt', 5, {'method_name': 'HoltV2', 'alpha': 0.8, 'beta': 0.2})
LIMIT 1;
----
true

# Test 4: Custom method_name with AutoETS model
query I
SELECT method_name = 'MyAutoETS'
FROM ts_forecast(test_data, date_col, value, 'AutoETS', 5, {'method_name': 'MyAutoETS', 'season_length': 7})
LIMIT 1;
----
true

# Test 5: Custom method_name with Theta model
query I
SELECT method_name = 'ThetaCustom'
FROM ts_forecast(test_data, date_col, value, 'Theta', 5, {'method_name': 'ThetaCustom', 'seasonal_period': 7})
LIMIT 1;
----
true

# Test 6: Custom method_name with SMA model
query I
SELECT method_name = 'MovingAvg5'
FROM ts_forecast(test_data, date_col, value, 'SMA', 5, {'method_name': 'MovingAvg5', 'window': 5})
LIMIT 1;
----
true

# Test 7: Verify forecasts still work correctly with custom names
query I
SELECT COUNT(*) = 5
FROM ts_forecast(test_data, date_col, value, 'Naive', 5, {'method_name': 'CustomNaive'});
----
true

# Test 8: Multiple models with custom names in same query
statement ok
CREATE TABLE multi_model_results AS
WITH naive_result AS (
    SELECT 'naive' as model_type, * 
    FROM ts_forecast(test_data, date_col, value, 'Naive', 5, {'method_name': 'NaiveCustom'})
),
ses_result AS (
    SELECT 'ses' as model_type, *
    FROM ts_forecast(test_data, date_col, value, 'SES', 5, {'method_name': 'SESCustom', 'alpha': 0.3})
)
SELECT * FROM naive_result
UNION ALL
SELECT * FROM ses_result;

query II
SELECT DISTINCT method_name, COUNT(*) 
FROM multi_model_results 
GROUP BY method_name 
ORDER BY method_name;
----
NaiveCustom	5
SESCustom	5

# Cleanup
statement ok
DROP TABLE test_data;

statement ok
DROP TABLE multi_model_results;

