# Model Selection Guide - Choosing the Right Forecasting Model

## Decision Tree

```
Do you know which model to use?
│
├─ NO → Start with AutoETS ✅
│       (Handles most cases automatically)
│
└─ YES → Answer these questions:
         │
         ├─ Multiple seasonality? (daily + weekly + yearly)
         │  └─ YES → MSTL, AutoMSTL, or TBATS
         │
         ├─ Intermittent demand? (many zeros)
         │  └─ YES → Croston, ADIDA, IMAPA
         │
         ├─ Simple pattern? (need fast forecast)
         │  └─ YES → SeasonalNaive, Theta
         │
         └─ Complex pattern? (need high accuracy)
            └─ YES → AutoARIMA, AutoETS
```

## Model Categories

### 1. Automatic Selection (⭐ Recommended)

**API Behavior**: Automatic model selection with parameter optimization. No manual parameter tuning required.

| Model | Best For | Speed (10K rows) | Parameter Optimization | Models Evaluated |
|-------|----------|------------------|------------------------|------------------|
| **AutoETS** | General purpose, seasonal data | 3-4s | Full grid search | 30+ ETS variants |
| **AutoARIMA** | Complex patterns, trend+seasonality | 3-10s | Stepwise with early termination | ARIMA(p,d,q)(P,D,Q) |
| **AutoMFLES** | Multiple seasonality | 2-5s | Learning rate optimization | Gradient boosting |
| **AutoMSTL** | Multiple seasonality, decomposition | 1-3s | LOESS parameter tuning | STL variants |
| **AutoTBATS** | Complex multiple seasonality | 5-15s | Box-Cox + ARMA optimization | TBATS variants |

**Behavioral Notes**:
- Early termination prevents excessive runtime on long series
- Information criteria (AIC/BIC) guide model selection
- Convergence failure triggers fallback to simpler models

**Example**:
<!-- include: test/sql/docs_examples/40_model_selection_evaluate_01.sql -->

### 2. Simple & Fast Models

**API Behavior**: Minimal computation, suitable for real-time forecasting and baselines.

| Model | Pattern | Speed (10K rows) | Parameters | Computational Complexity |
|-------|---------|------------------|------------|-------------------------|
| **Naive** | Random walk | <1ms | None | O(1) |
| **SeasonalNaive** | Seasonality only | <1ms | seasonal_period (required) | O(1) |
| **SMA** | Smoothing | <1ms | window (default: 5) | O(window) |
| **SeasonalWindowAverage** | Seasonal + smoothing | <1ms | seasonal_period, window | O(seasonal_period + window) |

**Behavioral Notes**:
- No parameter optimization required
- Constant memory footprint
- Suitable for baseline comparisons via MASE metric

**Example**:
<!-- include: test/sql/docs_examples/40_model_selection_seasonality_02.sql -->

### 3. Exponential Smoothing

**When**: Trend and/or seasonality present

| Model | Components | Optimization | Use Case |
|-------|------------|--------------|----------|
| **SES** | Level only | Manual | Smooth, no trend |
| **SESOptimized** | Level only | Automatic | Smooth, no trend |
| **Holt** | Level + trend | Manual | Linear trend |
| **HoltWinters** | Level + trend + seasonal | Manual | Classic seasonal |
| **SeasonalES** | Level + seasonal | Manual | Seasonal, no trend |
| **SeasonalESOptimized** | Level + seasonal | Automatic | Seasonal, no trend |

**Example**:
<!-- include: test/sql/docs_examples/40_model_selection_example_03.sql -->

### 4. State Space Models (ETS)

**When**: Need flexible modeling framework

**ETS Formula**: Y = f(Error, Trend, Seasonal)

| Configuration | Code | Use When |
|---------------|------|----------|
| (A,N,N) | error_type=0, trend_type=0, season_type=0 | Simple level |
| (A,A,N) | error_type=0, trend_type=1, season_type=0 | Linear trend |
| (A,Ad,N) | error_type=0, trend_type=2, season_type=0 | Damped trend |
| (A,N,A) | error_type=0, trend_type=0, season_type=1 | Seasonal only |
| (A,A,A) | error_type=0, trend_type=1, season_type=1 | Trend + seasonal |

**Example**:
<!-- include: test/sql/docs_examples/40_model_selection_example_04.sql -->

### 5. ARIMA Models

**When**: Need to model autocorrelation explicitly

**Parameters**:
- **p**: Autoregressive order (how many past values)
- **d**: Differencing (make stationary)
- **q**: Moving average order (how many past errors)

| Model | Configuration | Use When |
|-------|---------------|----------|
| AR(1) | p=1, d=0, q=0 | Strong autocorrelation |
| MA(1) | p=0, d=0, q=1 | Shock response |
| ARIMA(1,1,1) | p=1, d=1, q=1 | Non-stationary with trend |
| SARIMA(1,1,1)(1,1,1,7) | + seasonal | Seasonal non-stationary |

**Example**:
<!-- include: test/sql/docs_examples/40_model_selection_example_05.sql -->

### 6. Theta Methods

**When**: Data with trend and seasonality, need simplicity

| Model | Optimization | Use When |
|-------|--------------|----------|
| **Theta** | Manual | Know optimal θ parameter |
| **OptimizedTheta** | Automatic | Let it optimize θ |
| **DynamicTheta** | Adaptive | Changing patterns |
| **DynamicOptimizedTheta** | Auto adaptive | Complex changing patterns |

**Example**:
<!-- include: test/sql/docs_examples/40_model_selection_seasonality_06.sql -->

### 7. Multiple Seasonality Models

**When**: Data has multiple seasonal patterns (e.g., hourly data with daily + weekly patterns)

| Model | Method | Speed | Best For |
|-------|--------|-------|----------|
| **MSTL** | STL decomposition | Fast | Clear multiple patterns |
| **AutoMSTL** | Auto MSTL | Fast | Auto multiple patterns |
| **MFLES** | Multiple FLES | Medium | Complex multiple seasonality |
| **AutoMFLES** | Auto MFLES | Medium | Auto multiple complex |
| **TBATS** | Trigonometric + Box-Cox | Slow | Very complex patterns |
| **AutoTBATS** | Auto TBATS | Very Slow | Auto very complex |

**Example**:
<!-- include: test/sql/docs_examples/40_model_selection_seasonality_07.sql -->

### 8. Intermittent Demand Models

**When**: Data has many zeros (sparse demand)

| Model | Method | Use When |
|-------|--------|----------|
| **CrostonClassic** | Classic Croston | Moderate intermittency |
| **CrostonOptimized** | Optimized parameters | Moderate intermittency |
| **CrostonSBA** | Syntetos-Boylan | Less biased |
| **ADIDA** | Aggregate-Disaggregate | Aggregation helpful |
| **IMAPA** | Moving average | Smoothing needed |
| **TSB** | Teunter-Syntetos-Babai | Obsolescence |

**Example**:
<!-- include: test/sql/docs_examples/40_model_selection_example_08.sql -->

## Selection Criteria

### By Data Characteristics

#### Frequency
| Frequency | Seasonal Period | Recommended Models |
|-----------|----------------|---------------------|
| **Hourly** | 24, 168 | MSTL, TBATS |
| **Daily** | 7, 30, 365 | AutoETS, SeasonalNaive |
| **Weekly** | 4, 52 | AutoETS, Theta |
| **Monthly** | 12 | AutoETS, AutoARIMA, Theta |
| **Quarterly** | 4 | AutoETS, Holt |
| **Yearly** | - | Holt, AutoARIMA (non-seasonal) |

#### Data Size
| Series Length | Recommended | Avoid |
|---------------|-------------|-------|
| **< 30 obs** | Naive, SMA | AutoARIMA, TBATS |
| **30-100 obs** | SeasonalNaive, Theta, AutoETS | TBATS |
| **100-365 obs** | AutoETS, AutoARIMA, MSTL | - |
| **> 365 obs** | Any model | - |

#### Pattern Complexity
| Pattern | Model Complexity | Examples |
|---------|------------------|----------|
| **Simple** | Naive, SeasonalNaive | Weekly sales, no trend |
| **Moderate** | Theta, ETS, HoltWinters | Trending seasonal sales |
| **Complex** | AutoETS, AutoARIMA | Multiple patterns |
| **Very Complex** | TBATS, MSTL | Hourly data, multiple seasonality |

### By Business Requirements

#### Speed vs Accuracy Trade-off

```
Fast ←──────────────────────────────────→ Accurate
│                                           │
Naive                                    AutoTBATS
SeasonalNaive                           AutoARIMA
Theta                                   AutoETS
HoltWinters                             MSTL
```

**Example**: Production forecasting (need speed)
<!-- include: test/sql/docs_examples/40_model_selection_example_09.sql -->

**Example**: Strategic planning (need accuracy)
<!-- include: test/sql/docs_examples/40_model_selection_multi_series_10.sql -->

## Model Comparison Framework

### Compare Multiple Models

<!-- include: test/sql/docs_examples/40_model_selection_evaluate_11.sql -->

## Model Strengths & Weaknesses

### AutoETS

**Strengths**:
- ✅ Automatic parameter selection
- ✅ Handles trend + seasonality
- ✅ Fast optimization
- ✅ Robust to noise
- ✅ Interpretable

**Weaknesses**:
- ❌ Single seasonality only
- ❌ Assumes exponential smoothing appropriate

**Best for**: General-purpose forecasting, 80% of use cases

### AutoARIMA

**Strengths**:
- ✅ Handles complex autocorrelation
- ✅ Very flexible
- ✅ Can model differencing
- ✅ Often most accurate

**Weaknesses**:
- ❌ Slower than ETS
- ❌ Can overfit with small data
- ❌ Less interpretable

**Best for**: Complex economic/financial data, when accuracy is critical

### SeasonalNaive

**Strengths**:
- ✅ Extremely fast
- ✅ No parameters to tune
- ✅ Good baseline
- ✅ Works with short series

**Weaknesses**:
- ❌ Ignores trend
- ❌ Simple intervals
- ❌ Lower accuracy for complex data

**Best for**: Simple seasonal patterns, benchmarking, large-scale forecasting

### Theta

**Strengths**:
- ✅ Good accuracy with minimal tuning
- ✅ Fast
- ✅ Handles trend well
- ✅ Robust

**Weaknesses**:
- ❌ Limited seasonality handling
- ❌ Fixed decomposition approach

**Best for**: Data with trend and seasonality, need reliability

### TBATS

**Strengths**:
- ✅ Multiple complex seasonality
- ✅ Box-Cox transformation
- ✅ ARMA errors
- ✅ Very flexible

**Weaknesses**:
- ❌ Very slow
- ❌ Can overfit
- ❌ Requires long series

**Best for**: Hourly/sub-daily data with multiple seasonality (when accuracy >> speed)

### Croston Methods

**Strengths**:
- ✅ Designed for intermittent demand
- ✅ Handles many zeros well
- ✅ Separates demand probability and size

**Weaknesses**:
- ❌ Not for continuous demand
- ❌ Limited seasonality handling

**Best for**: Spare parts, infrequent purchases, slow-moving inventory

## Selection Flowchart

```
Start
  │
  ├─ Data frequency?
  │  ├─ Hourly/Sub-daily → MSTL, TBATS
  │  ├─ Daily → AutoETS, SeasonalNaive, AutoARIMA
  │  ├─ Weekly → AutoETS, Theta
  │  └─ Monthly/Quarterly → AutoETS, AutoARIMA
  │
  ├─ Intermittent (>30% zeros)?
  │  └─ YES → Croston, ADIDA, IMAPA
  │
  ├─ Multiple seasonality?
  │  └─ YES → MSTL, AutoMSTL, TBATS
  │
  ├─ Speed critical?
  │  ├─ YES → SeasonalNaive, Theta
  │  └─ NO → AutoETS, AutoARIMA
  │
  └─ Need highest accuracy?
     └─ YES → AutoARIMA or AutoETS (compare both)
```

## Practical Examples

### Example 1: Retail Sales (Daily)

**Pattern**: Weekly seasonality + trend

<!-- include: test/sql/docs_examples/40_model_selection_evaluate_12.sql -->

### Example 2: Website Traffic (Hourly)

**Pattern**: Daily (24h) + weekly (168h) seasonality

<!-- include: test/sql/docs_examples/40_model_selection_multi_series_13.sql -->

### Example 3: Spare Parts Demand (Intermittent)

**Pattern**: Many zeros, occasional spikes

<!-- include: test/sql/docs_examples/40_model_selection_example_14.sql -->

### Example 4: Monthly Revenue (Long-term)

**Pattern**: Yearly seasonality + trend

<!-- include: test/sql/docs_examples/40_model_selection_multi_series_15.sql -->

### Example 5: Electricity Demand (Half-hourly)

**Pattern**: Daily (48) + weekly (336) + yearly seasonality

<!-- include: test/sql/docs_examples/40_model_selection_seasonality_16.sql -->

## Parameter Tuning

### When to Tune vs When to Use Auto

**Use Auto** (90% of cases):
- Exploratory analysis
- Production forecasting at scale
- Unknown optimal parameters
- Need reliability over perfection

**Tune Manually** (10% of cases):
- Benchmark performance
- Specific domain knowledge
- Fine-tuning after Auto selection
- Research/experimentation

### How to Tune

<!-- include: test/sql/docs_examples/40_model_selection_example_17.sql -->

## Model Ensemble (Future Feature)

**Concept**: Combine multiple models for better accuracy

<!-- include: test/sql/docs_examples/40_model_selection_evaluate_18.sql -->

**Current workaround**: Average forecasts manually
<!-- include: test/sql/docs_examples/40_model_selection_example_19.sql -->

## Troubleshooting

### Model Fails or Returns Errors

**Error**: "Series too short for seasonal model"
<!-- include: test/sql/docs_examples/40_model_selection_example_20.sql -->

**Error**: "ETS season length must be at least 2"
<!-- include: test/sql/docs_examples/40_model_selection_example_21.sql -->

**Error**: "Constant series detected"
<!-- include: test/sql/docs_examples/40_model_selection_seasonality_22.sql -->

### Poor Forecast Accuracy

**Check**:
1. Data quality: `TS_STATS()`, `TS_QUALITY_REPORT()`
2. Seasonality: `TS_DETECT_SEASONALITY_ALL()`
3. Changepoints: `TS_DETECT_CHANGEPOINTS_BY()`
4. Model fit: Check `insample_fitted` with `return_insample: true`

**Try**:
1. Different models
2. Different seasonal_period
3. Longer training window
4. Data transformation (log, differencing)
5. Remove outliers
6. Handle changepoints separately

## Summary

**Quick Reference**:

| Your Situation | Recommended Model |
|----------------|-------------------|
| **Don't know what to use** | AutoETS |
| **Need speed** | SeasonalNaive |
| **Need accuracy** | AutoARIMA |
| **Multiple seasonality** | AutoMSTL, TBATS |
| **Intermittent demand** | CrostonOptimized |
| **Simple patterns** | Theta, SeasonalNaive |
| **Complex patterns** | AutoETS, AutoARIMA |
| **Forecasting 1000s of series** | SeasonalNaive, AutoETS |

**Decision Process**:
1. Start with AutoETS
2. Check accuracy with `TS_MAPE()`, `TS_COVERAGE()`
3. If < 20% MAPE and good coverage → Deploy!
4. If not satisfactory → Try AutoARIMA or specialized model
5. Compare models and select best

**Next**: [Parameters Guide](12_parameters.md) - Detailed parameter tuning

---

**Remember**: "All models are wrong, but some are useful" - George Box

The best model is the one that works for YOUR data and YOUR business needs!

