# EDA & Data Preparation - Complete Workflow Guide

## Introduction

Data quality directly impacts forecast accuracy. This guide covers exploratory data analysis and preparation using SQL macros that operate on time series at scale.

**API Coverage**: 5 EDA macros + 2 Data Quality Health Card macros + 12 data preparation macros for comprehensive data quality workflows.

## Complete Workflow

### Phase 1: Explore Your Data (EDA)

#### Step 1: Generate Statistics

<!-- include: test/sql/docs_examples/11_exploratory_analysis_evaluate_01.sql -->

**Output Schema**:
Returns comprehensive statistics per series including:
- **Basic stats**: count, mean, std, min, max, median
- **Data quality**: null_count, gap_count, zero_count, constant_flag
- **Pattern indicators**: cv (coefficient of variation), intermittency_rate
- **Trend metrics**: trend_correlation, first_last_ratio

#### Step 2: Dataset Summary

<!-- include: test/sql/docs_examples/11_exploratory_analysis_data_quality_02.sql -->

**Example Output**:
```
total_series: 1,000
total_observations: 365,000
avg_series_length: 365
avg_quality_score: 0.8234
high_quality_series: 856
low_quality_series: 23
```

#### Step 3: Data Quality Health Card

**New**: Data quality assessment with actionable recommendations:

```sql
-- Generate comprehensive health card (n_short parameter defaults to 30 if NULL)
CREATE TABLE health_card AS
SELECT * FROM TS_DATA_QUALITY_HEALTH_CARD('sales_raw', product_id, date, sales_amount, 30);

-- View all issues
SELECT * FROM health_card ORDER BY dimension, metric;
```

**Example Output**:

| unique_id | dimension    | metric           | value                    |
|-----------|--------------|------------------|--------------------------|
| Store_A   | Temporal     | timestamp_gaps   | 15.2% gaps (23 missing) |
| Store_A   | Magnitude   | missing_values   | 8.5% missing (13 NULLs) |
| Store_B   | Temporal     | series_length    | 5 observations           |
| Store_C   | Behavioural  | intermittency    | 52.3% zeros             |

**Four Dimensions Assessed**:

1. **Structural**: 
  - Key uniqueness and
  - ID cardinality
2. **Temporal**: 
  - Frequency inference, 
  - Timestamp gaps, 
  - Series alignment, and 
  - Series length
3. **Magnitude**: 
  - Missing values, 
  - Value bounds, and 
  - Static values
4. **Behavioural**: 
  - Seasonality, 
  - Trend detection, and 
  - Intermittency

**Summary Function**:

```sql
-- Get summary by dimension (n_short parameter defaults to 30 if NULL)
SELECT * FROM TS_DATA_QUALITY_SUMMARY('sales_raw', product_id, date, sales_amount, 30);
```

#### Step 4: Identify Problems

<!-- include: test/sql/docs_examples/11_exploratory_analysis_example_04.sql -->

**Common Issues**:
- Many gaps → primary_issue = '⚠️ Many gaps'
- Null values → primary_issue = '⚠️ Missing values'
- Constant → primary_issue = '⚠️ Constant'

#### Step 5: Detect Patterns

<!-- include: test/sql/docs_examples/11_exploratory_analysis_statistics_05.sql -->

### Phase 2: Prepare Your Data

#### Standard Pipeline (Recommended)

<!-- include: test/sql/docs_examples/11_exploratory_analysis_seasonality_06.sql -->

#### Custom Pipeline (Advanced)

Tailor to your specific needs:

<!-- include: test/sql/docs_examples/11_exploratory_analysis_example_07.sql -->

### Phase 3: Validate Preparation

#### Compare Before/After

<!-- include: test/sql/docs_examples/11_exploratory_analysis_example_08.sql -->

**Expected Improvements**:
- Series with nulls: 45 → 0
- Series with gaps: 150 → 0
- Constant series: 23 → 0

## Common Data Issues & Solutions

### Issue 1: Missing Time Points

**Problem**: Dates are not continuous

<!-- include: test/sql/docs_examples/11_exploratory_analysis_example_09.sql -->

### Issue 2: Missing Values (NULLs)

**Problem**: Some values are NULL

**Solutions**:

<!-- include: test/sql/docs_examples/11_exploratory_analysis_create_sample_data_10.sql -->

### Issue 3: Constant Series

**Problem**: All values are the same

<!-- include: test/sql/docs_examples/11_exploratory_analysis_example_11.sql -->

### Issue 4: Short Series

**Problem**: Not enough historical data

<!-- include: test/sql/docs_examples/11_exploratory_analysis_statistics_12.sql -->

### Issue 5: Leading/Trailing Zeros

**Problem**: Product not yet launched or discontinued

<!-- include: test/sql/docs_examples/11_exploratory_analysis_example_13.sql -->

### Issue 6: Outliers

**Problem**: Extreme values distorting the pattern

<!-- include: test/sql/docs_examples/11_exploratory_analysis_example_14.sql -->

### Issue 7: Different End Dates

**Problem**: Series end on different dates

<!-- include: test/sql/docs_examples/11_exploratory_analysis_example_15.sql -->

## Advanced Preparation Techniques

## Data Quality Metrics

### Custom Quality Metrics

<!-- include: test/sql/docs_examples/11_exploratory_analysis_evaluate_22.sql -->

## Preparation Checklist

### Before Forecasting

- [ ] Check data quality: `TS_STATS()`, `TS_DATA_QUALITY_HEALTH_CARD()`
- [ ] Fill time gaps: `TS_FILL_GAPS()`
- [ ] Fill up to end date: `TS_FILL_FORWARD()`
- [ ] Handle missing values: `TS_FILL_NULLS_*()`
- [ ] Remove constant series: `TS_DROP_CONSTANT()`
- [ ] Check minimum length: `TS_DROP_SHORT()`
- [ ] Remove leading zeros: `TS_DROP_LEADING_ZEROS()`
- [ ] Detect seasonality: `TS_DETECT_SEASONALITY_ALL()`
- [ ] Detect changepoints: `TS_DETECT_CHANGEPOINTS_BY()`
- [ ] Remove edge zeros: `TS_DROP_EDGE_ZEROS()` (if applicable)
- [ ] Validate: Re-run `TS_STATS()` on prepared data

### Quality Gates

Define minimum standards:

<!-- include: test/sql/docs_examples/11_exploratory_analysis_data_quality_23.sql -->

## Automation

### Automated Data Prep Pipeline

<!-- include: test/sql/docs_examples/11_exploratory_analysis_data_quality_24.sql -->

